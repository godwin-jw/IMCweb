<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Yönetici Paneli | IMC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background-color: #1a1a2e;
            font-family: 'Segoe UI', sans-serif;
            color: #fff;
        }

        .sidebar {
            background-color: #16213e;
            min-height: 100vh;
            padding: 20px;
        }

        .card-stat {
            background-color: #0f3460;
            border: none;
            border-radius: 15px;
            padding: 20px;
            transition: 0.3s;
            color: white;
        }

            .card-stat:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }

        .table-dark-custom {
            background-color: #16213e;
            border-radius: 10px;
            overflow: hidden;
        }

            .table-dark-custom th, .table-dark-custom td {
                border-color: #2c3e50;
                color: #b2bec3;
                vertical-align: middle;
            }

        .btn-ban {
            background-color: #e94560;
            color: white;
            border: none;
        }

            .btn-ban:hover {
                background-color: #c0392b;
            }

        .badge-role {
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 sidebar d-none d-md-block">
                <h3 class="fw-bold mb-5 text-center text-primary"><i class="fa-solid fa-shield-halved"></i> IMC ADMIN</h3>
                <ul class="nav flex-column gap-3">
                    <li class="nav-item"><a href="#" class="nav-link text-white bg-primary rounded"><i class="fa-solid fa-gauge me-2"></i> Gösterge Paneli</a></li>
                    <li class="nav-item"><a href="/ogrenci" class="nav-link text-white-50"><i class="fa-solid fa-eye me-2"></i> Siteyi Görüntüle</a></li>
                    <li class="nav-item"><a href="/giris" class="nav-link text-white-50"><i class="fa-solid fa-right-from-bracket me-2"></i> Çıkış</a></li>
                </ul>
            </div>

            <div class="col-md-10 p-4">

                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <script>{% for category, message in messages %}Swal.fire({icon: '{{ category }}', title: 'Bilgi', text: '{{ message }}', confirmButtonColor: '#0f3460'});{% endfor %}</script>{% endif %}
                {% endwith %}

                <h2 class="fw-bold mb-4">Sistem Durumu 🚀</h2>

                <div class="row g-4 mb-5">
                    <div class="col-md-3">
                        <div class="card-stat">
                            <h6 class="text-white-50">TOPLAM ÜYE</h6>
                            <h2 class="fw-bold">{{ toplam_uye }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card-stat">
                            <h6 class="text-white-50">AKTİF İŞLETME</h6>
                            <h2 class="fw-bold text-warning">{{ toplam_esnaf }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card-stat">
                            <h6 class="text-white-50">KURTARILAN YEMEK</h6>
                            <h2 class="fw-bold text-success">{{ toplam_siparis }}</h2>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card-stat">
                            <h6 class="text-white-50">ÖĞRENCİ TASARRUFU</h6>
                            <h2 class="fw-bold text-info">{{ toplam_tasarruf }}₺</h2>
                        </div>
                    </div>
                </div>

                <h4 class="fw-bold mb-3">Son Kayıt Olan Kullanıcılar</h4>
                <div class="table-responsive">
                    <table class="table table-dark-custom table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kullanıcı</th>
                                <th>Rol</th>
                                <th>E-Posta</th>
                                <th>Konum</th>
                                <th>İşlem</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in kullanicilar %}
                            <tr>
                                <td>#{{ user['id'] }}</td>
                                <td>
                                    <img src="/static/uploads/{{ user['profil_resmi'] }}" class="rounded-circle me-2" style="width: 30px; height: 30px; object-fit: cover;">
                                    {{ user['ad_soyad'] }}
                                </td>
                                <td>
                                    {% if user['rol'] == 'esnaf' %}
                                    <span class="badge bg-warning text-dark badge-role">ESNAF</span>
                                    {% else %}
                                    <span class="badge bg-info text-dark badge-role">ÖĞRENCİ</span>
                                    {% endif %}
                                </td>
                                <td>{{ user['email'] }}</td>
                                <td><small class="text-muted">{{ user['enlem'] }}, {{ user['boylam'] }}</small></td>
                                <td>
                                    <button onclick="kullaniciSil({{ user['id'] }}, '{{ user['ad_soyad'] }}')" class="btn btn-sm btn-ban rounded-pill px-3">
                                        <i class="fa-solid fa-ban"></i> Yasakla
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <script>
    function kullaniciSil(id, ad) {
        Swal.fire({
            title: ad + ' silinecek?',
            text: "Bu kullanıcıyı ve tüm verilerini silmek üzeresiniz. Bu işlem geri alınamaz!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#e94560',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Evet, Sil!',
            cancelButtonText: 'Vazgeç'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "/kullanici-sil/" + id;
            }
        })
    }
    </script>

</body>
</html>